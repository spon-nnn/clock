<!--pages/pomodoro/pomodoro.wxml - ç•ªèŒ„é’Ÿé¡µé¢-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'timer' ? 'active' : ''}}" bindtap="switchTab" data-tab="timer">
      <text>ç•ªèŒ„é’Ÿ</text>
    </view>
    <view class="tab {{activeTab === 'schedule' ? 'active' : ''}}" bindtap="switchTab" data-tab="schedule">
      <text>æ—¥ç¨‹æé†’</text>
    </view>
    <view class="tab {{activeTab === 'stats' ? 'active' : ''}}" bindtap="switchTab" data-tab="stats">
      <text>ä¸“æ³¨ç»Ÿè®¡</text>
    </view>
  </view>

  <!-- ç•ªèŒ„é’Ÿè§†å›¾ -->
  <view class="timer-view" wx:if="{{activeTab === 'timer'}}">
    <!-- ä¸“æ³¨æ¨¡å¼æ ‡é¢˜ -->
    <view class="focus-header">
      <text class="focus-title">ä¸“æ³¨æ¨¡å¼</text>
      <text class="focus-subtitle">æå‡ä½ çš„å·¥ä½œæ•ˆç‡</text>
    </view>

    <!-- è®¡æ—¶å™¨åœ†ç¯ -->
    <view class="timer-ring-container">
      <view class="timer-ring white-ring"></view>
      <view class="timer-ring progress-ring" style="background: conic-gradient(var(--accent) {{progress}}%, transparent 0);"></view>
      <view class="timer-center">
        <view class="time-left">{{remaining}}</view>
        <view class="status-text">{{isFocusing ? 'ä¸“æ³¨ä¸­...' : 'å‡†å¤‡å¼€å§‹'}}</view>
      </view>
    </view>

    <!-- æ—¶é•¿é€‰æ‹©å™¨ -->
    <picker mode="selector" range="{{durations}}" value="{{durationIndex}}" bindchange="onDurationChange" disabled="{{isFocusing}}">
      <view class="duration-picker card">
        <view class="picker-label">ä¸“æ³¨æ—¶é•¿</view>
        <view class="picker-value">{{durations[durationIndex]}} åˆ†é’Ÿ ></view>
      </view>
    </picker>

    <!-- æ“ä½œæŒ‰é’® -->
    <button class="btn btn-primary btn-lg {{isFocusing ? 'btn-danger' : ''}}" bindtap="toggleFocus">
      {{isFocusing ? 'åœæ­¢ä¸“æ³¨' : 'å¼€å§‹ä¸“æ³¨'}}
    </button>

    <!-- ä»Šæ—¥ç»Ÿè®¡ -->
    <view class="stats-card card">
      <view class="stats-item">
        <view class="stats-num">{{todayFocus}}</view>
        <view class="stats-label">ä»Šæ—¥ä¸“æ³¨(åˆ†é’Ÿ)</view>
      </view>
      <view class="divider"></view>
      <view class="stats-item">
        <view class="stats-num">{{totalFocus}}</view>
        <view class="stats-label">ç´¯è®¡ä¸“æ³¨(åˆ†é’Ÿ)</view>
      </view>
    </view>
  </view>

  <!-- æ—¥ç¨‹è§†å›¾ (ç®€åŒ–ç‰ˆ) -->
  <view class="schedule-view" wx:if="{{activeTab === 'schedule'}}">
    <view class="schedule-header">
      <text class="date-display">{{currentDateStr}}</text>
      <view class="add-btn" bindtap="goToSchedule">+ æ·»åŠ æé†’</view>
    </view>

    <view class="schedule-list card">
      <view class="schedule-item" wx:for="{{todaySchedules}}" wx:key="id">
        <view class="schedule-time">{{item.startTime}}</view>
        <view class="schedule-detail">
          <text class="schedule-title">{{item.content}}</text>
          <text class="schedule-desc">{{item.category === 'work' ? 'å·¥ä½œ' : item.category === 'life' ? 'ç”Ÿæ´»' : 'å­¦ä¹ '}}</text>
        </view>
        <view class="schedule-actions">
          <text class="edit-icon" catchtap="editSchedule" data-item="{{item}}">âœï¸</text>
          <text class="delete-icon" catchtap="deleteSchedule" data-id="{{item.id}}">ğŸ—‘ï¸</text>
        </view>
      </view>
      <view class="empty-schedule" wx:if="{{todaySchedules.length === 0}}">
        <text>ä»Šæ—¥æš‚æ— æ—¥ç¨‹å®‰æ’</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡è§†å›¾ (ç®€åŒ–ç‰ˆ) -->
  <view class="stats-view" wx:if="{{activeTab === 'stats'}}">
    <!-- æ—¶é—´ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card card">
      <text class="card-title">ä¸“æ³¨æ—¶é—´ç»Ÿè®¡</text>

      <view class="stats-grid">
        <view class="stat-box">
          <text class="stat-value">{{weekFocusTime}}</text>
          <text class="stat-label">æœ¬å‘¨ä¸“æ³¨</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{monthFocusTime}}</text>
          <text class="stat-label">æœ¬æœˆä¸“æ³¨</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{totalPomodoros}}</text>
          <text class="stat-label">å®Œæˆç•ªèŒ„é’Ÿ</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{streakDays}}</text>
          <text class="stat-label">æœ€é•¿è¿ç»­å¤©æ•°</text>
        </view>
      </view>
    </view>

    <!-- ä»»åŠ¡åˆ†ç±»ç»Ÿè®¡ -->
    <view class="category-stats card">
      <text class="card-title">ä¸“æ³¨ä»»åŠ¡åˆ†ç±»</text>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">å·¥ä½œ</text>
          <text class="category-percent">{{categoryStats.work || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill work" style="width: {{categoryStats.work || 0}}%"></view>
        </view>
      </view>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">å­¦ä¹ </text>
          <text class="category-percent">{{categoryStats.study || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill study" style="width: {{categoryStats.study || 0}}%"></view>
        </view>
      </view>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">ç”Ÿæ´»</text>
          <text class="category-percent">{{categoryStats.life || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill life" style="width: {{categoryStats.life || 0}}%"></view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- ä»»åŠ¡é€‰æ‹©å¼¹çª— -->
<view class="task-modal" wx:if="{{showTaskModal}}" bindtap="hideTaskModal">
  <view class="task-modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©ä»»åŠ¡</text>
      <view class="modal-close" bindtap="hideTaskModal">Ã—</view>
    </view>

    <view class="task-list">
      <view class="task-option"
            wx:for="{{taskList}}"
            wx:key="id"
            bindtap="selectTaskItem"
            data-task="{{item}}">
        <text class="task-option-time">{{item.startTime}}</text>
        <text class="task-option-content">{{item.content}}</text>
      </view>
      <view class="no-tasks" wx:if="{{taskList.length === 0}}">
        <text>æš‚æ— å¾…åŠä»»åŠ¡</text>
      </view>
    </view>

    <view class="quick-add">
      <input class="quick-input" placeholder="å¿«é€Ÿæ·»åŠ ä»»åŠ¡" value="{{quickTaskName}}" bindinput="onQuickInput"/>
      <button class="quick-btn" bindtap="quickAddTask">æ·»åŠ </button>
    </view>
  </view>
</view>

