<!--pages/pomodoro/pomodoro.wxml - ç•ªèŒ„é’Ÿé¡µé¢-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'timer' ? 'active' : ''}}" bindtap="switchTab" data-tab="timer">
      <text>ç•ªèŒ„é’Ÿ</text>
    </view>
    <view class="tab {{activeTab === 'schedule' ? 'active' : ''}}" bindtap="switchTab" data-tab="schedule">
      <text>æ—¥ç¨‹æé†’</text>
    </view>
    <view class="tab {{activeTab === 'stats' ? 'active' : ''}}" bindtap="switchTab" data-tab="stats">
      <text>ä¸“æ³¨ç»Ÿè®¡</text>
    </view>
  </view>

  <!-- ç•ªèŒ„é’Ÿè§†å›¾ -->
  <view class="timer-view" wx:if="{{activeTab === 'timer'}}">
    <!-- ä¸“æ³¨æ¨¡å¼æ ‡é¢˜ -->
    <view class="focus-header">
      <text class="focus-title">ä¸“æ³¨æ¨¡å¼</text>
      <text class="focus-subtitle">æå‡ä½ çš„å·¥ä½œæ•ˆç‡</text>
    </view>

    <!-- è®¡æ—¶å™¨åœ†ç¯ -->
    <view class="timer-ring-container">
      <view class="timer-ring">
        <canvas canvas-id="timerCanvas" class="timer-canvas"></canvas>
        <view class="timer-content">
          <text class="timer-value">{{timerDisplay}}</text>
          <text class="timer-status">{{isFocusing ? 'ä¸“æ³¨ä¸­' : 'å‡†å¤‡å¼€å§‹'}}</text>
        </view>
      </view>
    </view>

    <!-- æ—¶é•¿é€‰æ‹© -->
    <view class="duration-options">
      <view class="duration-btn {{focusDuration === 25 ? 'active' : ''}}"
            bindtap="setDuration" data-duration="25">
        25åˆ†é’Ÿ
      </view>
      <view class="duration-btn {{focusDuration === 5 ? 'active' : ''}}"
            bindtap="setDuration" data-duration="5">
        5åˆ†é’Ÿ
      </view>
      <view class="duration-btn {{focusDuration === 15 ? 'active' : ''}}"
            bindtap="setDuration" data-duration="15">
        15åˆ†é’Ÿ
      </view>
    </view>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <view class="control-buttons">
      <view class="control-btn reset" bindtap="resetTimer">
        <text class="btn-icon">â†»</text>
      </view>
      <view class="control-btn {{isFocusing ? 'pause' : 'play'}}" bindtap="toggleTimer">
        <text class="btn-icon">{{isFocusing ? 'â¸' : 'â–¶'}}</text>
      </view>
      <view class="control-btn skip" bindtap="skipTimer">
        <text class="btn-icon">â­</text>
      </view>
    </view>

    <!-- å½“å‰ä¸“æ³¨ä»»åŠ¡ -->
    <view class="current-task card">
      <view class="card-header">
        <text class="card-title">å½“å‰ä¸“æ³¨ä»»åŠ¡</text>
        <view class="add-task-btn" bindtap="selectTask">
          <text>+</text>
        </view>
      </view>

      <view class="task-item" wx:if="{{currentTask}}">
        <view class="task-checkbox {{currentTask.isDone ? 'checked' : ''}}"
              bindtap="toggleTask">
          <text wx:if="{{currentTask.isDone}}">âœ“</text>
        </view>
        <view class="task-info">
          <text class="task-name">{{currentTask.content}}</text>
          <text class="task-estimate">é¢„è®¡éœ€è¦ {{currentTask.pomodoros || 1}} ä¸ªç•ªèŒ„é’Ÿ</text>
        </view>
      </view>
      <view class="no-task" wx:else bindtap="selectTask">
        <text>ç‚¹å‡»é€‰æ‹©æˆ–æ·»åŠ ä»»åŠ¡</text>
      </view>

      <view class="today-focus-summary">
        <text class="summary-text">ä»Šæ—¥å·²ä¸“æ³¨</text>
        <text class="summary-value">{{todayFocusTime}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¥ç¨‹è§†å›¾ (ç®€åŒ–ç‰ˆ) -->
  <view class="schedule-view" wx:if="{{activeTab === 'schedule'}}">
    <view class="schedule-header">
      <text class="date-display">{{currentDateStr}}</text>
      <view class="add-btn" bindtap="goToSchedule">+ æ·»åŠ æé†’</view>
    </view>

    <view class="schedule-list card">
      <view class="schedule-item" wx:for="{{todaySchedules}}" wx:key="id">
        <view class="schedule-time">{{item.startTime}}</view>
        <view class="schedule-detail">
          <text class="schedule-title">{{item.content}}</text>
          <text class="schedule-desc">{{item.category === 'work' ? 'å·¥ä½œ' : item.category === 'life' ? 'ç”Ÿæ´»' : 'å­¦ä¹ '}}</text>
        </view>
        <view class="schedule-actions">
          <text class="edit-icon" catchtap="editSchedule" data-item="{{item}}">âœï¸</text>
          <text class="delete-icon" catchtap="deleteSchedule" data-id="{{item.id}}">ğŸ—‘ï¸</text>
        </view>
      </view>
      <view class="empty-schedule" wx:if="{{todaySchedules.length === 0}}">
        <text>ä»Šæ—¥æš‚æ— æ—¥ç¨‹å®‰æ’</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡è§†å›¾ (ç®€åŒ–ç‰ˆ) -->
  <view class="stats-view" wx:if="{{activeTab === 'stats'}}">
    <!-- æ—¶é—´ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card card">
      <text class="card-title">ä¸“æ³¨æ—¶é—´ç»Ÿè®¡</text>

      <view class="stats-grid">
        <view class="stat-box">
          <text class="stat-value">{{weekFocusTime}}</text>
          <text class="stat-label">æœ¬å‘¨ä¸“æ³¨</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{monthFocusTime}}</text>
          <text class="stat-label">æœ¬æœˆä¸“æ³¨</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{totalPomodoros}}</text>
          <text class="stat-label">å®Œæˆç•ªèŒ„é’Ÿ</text>
        </view>
        <view class="stat-box">
          <text class="stat-value">{{streakDays}}</text>
          <text class="stat-label">æœ€é•¿è¿ç»­å¤©æ•°</text>
        </view>
      </view>
    </view>

    <!-- ä»»åŠ¡åˆ†ç±»ç»Ÿè®¡ -->
    <view class="category-stats card">
      <text class="card-title">ä¸“æ³¨ä»»åŠ¡åˆ†ç±»</text>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">å·¥ä½œ</text>
          <text class="category-percent">{{categoryStats.work || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill work" style="width: {{categoryStats.work || 0}}%"></view>
        </view>
      </view>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">å­¦ä¹ </text>
          <text class="category-percent">{{categoryStats.study || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill study" style="width: {{categoryStats.study || 0}}%"></view>
        </view>
      </view>

      <view class="category-bar-item">
        <view class="category-header">
          <text class="category-name">ç”Ÿæ´»</text>
          <text class="category-percent">{{categoryStats.life || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill life" style="width: {{categoryStats.life || 0}}%"></view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- ä»»åŠ¡é€‰æ‹©å¼¹çª— -->
<view class="task-modal" wx:if="{{showTaskModal}}" bindtap="hideTaskModal">
  <view class="task-modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©ä»»åŠ¡</text>
      <view class="modal-close" bindtap="hideTaskModal">Ã—</view>
    </view>

    <view class="task-list">
      <view class="task-option"
            wx:for="{{taskList}}"
            wx:key="id"
            bindtap="selectTaskItem"
            data-task="{{item}}">
        <text class="task-option-time">{{item.startTime}}</text>
        <text class="task-option-content">{{item.content}}</text>
      </view>
      <view class="no-tasks" wx:if="{{taskList.length === 0}}">
        <text>æš‚æ— å¾…åŠä»»åŠ¡</text>
      </view>
    </view>

    <view class="quick-add">
      <input class="quick-input" placeholder="å¿«é€Ÿæ·»åŠ ä»»åŠ¡" value="{{quickTaskName}}" bindinput="onQuickInput"/>
      <button class="quick-btn" bindtap="quickAddTask">æ·»åŠ </button>
    </view>
  </view>
</view>

