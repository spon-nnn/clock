<!--pages/index/index.wxml - è®¾å¤‡åˆ—è¡¨é¡µé¢ï¼ˆç±»ä¼¼ç±³å®¶é¦–é¡µï¼‰-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="title">æˆ‘çš„è®¾å¤‡</text>
    <view class="add-btn" bindtap="goToScan">
      <text class="add-icon">+</text>
    </view>
  </view>

  <!-- è®¾å¤‡åˆ—è¡¨ -->
  <view class="device-list" wx:if="{{devices.length > 0}}">
    <view class="device-card {{currentDevice && currentDevice.deviceId === item.deviceId ? 'active' : ''}}"
          wx:for="{{devices}}"
          wx:key="deviceId"
          bindtap="selectDevice"
          bindlongpress="showDeviceMenu"
          data-device="{{item}}">

      <!-- è®¾å¤‡å›¾æ ‡å’ŒçŠ¶æ€ -->
      <view class="device-icon">
        <image src="/images/clock-icon.png" mode="aspectFit" class="icon-img"></image>
        <view class="status-dot {{item.online ? 'online' : 'offline'}}"></view>
      </view>

      <!-- è®¾å¤‡ä¿¡æ¯ -->
      <view class="device-info">
        <text class="device-name">{{item.name || 'å¤ªç©ºäººæ—¶é’Ÿ'}}</text>
        <text class="device-id">{{item.deviceId}}</text>
        <text class="device-status">{{item.online ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
      </view>

      <!-- å¿«æ·æ“ä½œ -->
      <view class="device-actions">
        <view class="action-btn" catchtap="goToDevice" data-device="{{item}}">
          <text class="action-icon">â–¶</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <image src="/images/empty-device.png" mode="aspectFit" class="empty-img"></image>
    <text class="empty-title">æš‚æ— è®¾å¤‡</text>
    <text class="empty-desc">ç‚¹å‡»å³ä¸Šè§’ + å·æ‰«ç æ·»åŠ è®¾å¤‡</text>
    <button class="btn-primary mt-40" bindtap="goToScan">æ·»åŠ è®¾å¤‡</button>
  </view>

  <!-- å½“å‰é€‰ä¸­è®¾å¤‡çš„å¤©æ°”å¡ç‰‡ -->
  <view class="weather-card card" wx:if="{{currentDevice && currentDevice.online && weatherData}}">
    <view class="weather-header flex-between">
      <view>
        <text class="city-name">{{weatherData.city || 'æœªçŸ¥åŸå¸‚'}}</text>
        <text class="update-time">æ›´æ–°äº {{weatherData.updateTime || '--:--'}}</text>
      </view>
      <view class="weather-icon">ğŸŒ¤ï¸</view>
    </view>

    <view class="weather-main">
      <text class="temperature">{{weatherData.temp || '--'}}Â°</text>
      <text class="weather-desc">{{weatherData.weather || 'æœªçŸ¥'}}</text>
    </view>

    <view class="weather-details flex-between">
      <view class="detail-item">
        <text class="detail-icon">ğŸ’§</text>
        <text class="detail-value">{{weatherData.humidity || '--'}}%</text>
      </view>
      <view class="detail-item">
        <text class="detail-icon">ğŸŒ¬ï¸</text>
        <text class="detail-value">{{weatherData.wind || '--'}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-icon">ğŸŒ¡ï¸</text>
        <text class="detail-value">{{weatherData.aqi || '--'}}</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ—¥ç¨‹é¢„è§ˆ -->
  <view class="schedule-preview card" wx:if="{{currentDevice && todaySchedules.length > 0}}">
    <view class="card-header flex-between">
      <text class="card-title">ä»Šæ—¥æ—¥ç¨‹</text>
      <text class="more-link" bindtap="goToSchedule">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <view class="schedule-item" wx:for="{{todaySchedules}}" wx:key="id" wx:if="{{index < 3}}">
      <view class="schedule-time">{{item.startTime}}</view>
      <view class="schedule-content">
        <text class="schedule-title">{{item.content}}</text>
        <text class="tag tag-{{item.category}}">{{categoryNames[item.category]}}</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥ä¸“æ³¨ç»Ÿè®¡ -->
  <view class="focus-card card" wx:if="{{currentDevice}}">
    <view class="card-header flex-between">
      <text class="card-title">ä»Šæ—¥ä¸“æ³¨</text>
      <text class="more-link" bindtap="goToStats">è¯¦ç»†ç»Ÿè®¡ ></text>
    </view>

    <view class="focus-stats flex-between">
      <view class="stat-item">
        <text class="stat-value text-blue">{{focusStats.today || 0}}</text>
        <text class="stat-label">åˆ†é’Ÿ</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value text-green">{{focusStats.sessions || 0}}</text>
        <text class="stat-label">ç•ªèŒ„é’Ÿ</text>
      </view>
    </view>
  </view>
</view>

<!-- è®¾å¤‡æ“ä½œèœå• -->
<view class="action-sheet" wx:if="{{showMenu}}" bindtap="hideMenu">
  <view class="action-sheet-content" catchtap="">
    <view class="action-item" bindtap="renameDevice">
      <text class="action-icon">âœï¸</text>
      <text>é‡å‘½å</text>
    </view>
    <view class="action-item" bindtap="refreshDevice">
      <text class="action-icon">ğŸ”„</text>
      <text>åˆ·æ–°çŠ¶æ€</text>
    </view>
    <view class="action-item danger" bindtap="unbindDevice">
      <text class="action-icon">ğŸ—‘ï¸</text>
      <text>è§£é™¤ç»‘å®š</text>
    </view>
  </view>
</view>

