<!--pages/stats/stats.wxml - ç»Ÿè®¡é¡µé¢-->
<view class="container">
  <!-- é¡¶éƒ¨æ€»è§ˆ -->
  <view class="overview-card">
    <view class="overview-header">
      <text class="overview-title">ä¸“æ³¨æ—¶é—´ç»Ÿè®¡</text>
      <view class="period-selector">
        <text class="period-btn {{period === 'week' ? 'active' : ''}}" bindtap="setPeriod" data-period="week">æœ¬å‘¨</text>
        <text class="period-btn {{period === 'month' ? 'active' : ''}}" bindtap="setPeriod" data-period="month">æœ¬æœˆ</text>
      </view>
    </view>

    <view class="stats-highlight">
      <view class="highlight-item">
        <text class="highlight-value">{{periodStats.hours}}</text>
        <text class="highlight-unit">å°æ—¶</text>
        <text class="highlight-label">{{period === 'week' ? 'æœ¬å‘¨ä¸“æ³¨' : 'æœ¬æœˆä¸“æ³¨'}}</text>
      </view>
      <view class="highlight-divider"></view>
      <view class="highlight-item">
        <text class="highlight-value">{{periodStats.minutes}}</text>
        <text class="highlight-unit">åˆ†é’Ÿ</text>
        <text class="highlight-label">{{period === 'week' ? 'æœ¬å‘¨ä¸“æ³¨' : 'æœ¬æœˆä¸“æ³¨'}}</text>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ç»Ÿè®¡ç½‘æ ¼ -->
  <view class="detail-grid">
    <view class="detail-card">
      <view class="detail-icon">ğŸ…</view>
      <text class="detail-value">{{totalPomodoros}}</text>
      <text class="detail-label">å®Œæˆç•ªèŒ„é’Ÿ</text>
    </view>
    <view class="detail-card">
      <view class="detail-icon">ğŸ”¥</view>
      <text class="detail-value">{{streakDays}}</text>
      <text class="detail-label">æœ€é•¿è¿ç»­å¤©æ•°</text>
    </view>
    <view class="detail-card">
      <view class="detail-icon">ğŸ“…</view>
      <text class="detail-value">{{activeDays}}</text>
      <text class="detail-label">æ´»è·ƒå¤©æ•°</text>
    </view>
    <view class="detail-card">
      <view class="detail-icon">â±ï¸</view>
      <text class="detail-value">{{avgDaily}}</text>
      <text class="detail-label">æ—¥å‡ä¸“æ³¨(åˆ†é’Ÿ)</text>
    </view>
  </view>

  <!-- åˆ†ç±»ç»Ÿè®¡ -->
  <view class="category-section card">
    <text class="section-title">ä¸“æ³¨ä»»åŠ¡åˆ†ç±»</text>

    <view class="category-chart">
      <!-- ç®€å•çš„æ¨ªå‘æ¡å½¢å›¾ -->
      <view class="category-row" wx:for="{{categories}}" wx:key="name">
        <view class="category-info">
          <view class="category-dot" style="background: {{item.color}}"></view>
          <text class="category-name">{{item.name}}</text>
        </view>
        <view class="category-bar-wrapper">
          <view class="category-bar" style="width: {{item.percent}}%; background: {{item.color}}"></view>
        </view>
        <text class="category-percent">{{item.percent}}%</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="records-section card">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘ä¸“æ³¨è®°å½•</text>
      <text class="clear-btn" bindtap="clearRecords">æ¸…ç©º</text>
    </view>

    <view class="record-list">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
        <view class="record-date">
          <text class="date-day">{{item.day}}</text>
          <text class="date-month">{{item.month}}æœˆ</text>
        </view>
        <view class="record-info">
          <text class="record-time">{{item.startTime}} - {{item.endTime}}</text>
          <text class="record-duration">{{item.duration}}åˆ†é’Ÿ</text>
        </view>
        <view class="record-note" wx:if="{{item.note}}">
          <text>{{item.note}}</text>
        </view>
      </view>

      <view class="empty-records" wx:if="{{recentRecords.length === 0}}">
        <text>æš‚æ— ä¸“æ³¨è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- è®¾å¤‡ä¿¡æ¯ -->
  <view class="device-section card" wx:if="{{device}}">
    <text class="section-title">å½“å‰è®¾å¤‡</text>
    <view class="device-info-row">
      <text class="device-label">è®¾å¤‡åç§°</text>
      <text class="device-value">{{device.name || 'å¤ªç©ºäººæ—¶é’Ÿ'}}</text>
    </view>
    <view class="device-info-row">
      <text class="device-label">è®¾å¤‡ID</text>
      <text class="device-value">{{device.deviceId}}</text>
    </view>
    <view class="device-info-row">
      <text class="device-label">IPåœ°å€</text>
      <text class="device-value">{{device.ip}}</text>
    </view>
    <view class="device-info-row">
      <text class="device-label">çŠ¶æ€</text>
      <text class="device-value {{device.online ? 'online' : 'offline'}}">{{device.online ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
    </view>
  </view>
</view>

